# Бот анализа документов для Mattermost

Интеллектуальный бот для анализа документации ИТ проектов с использованием GPT и автоматической генерацией PDF отчетов.

## Возможности

- **Интерактивный интерфейс**: Выбор типов проектов через кнопки (BI, DWH, RPA, MDM)
- **Многоформатная поддержка**: PDF, DOCX, XLSX, RTF, TXT файлы
- **Confluence интеграция**: Анализ страниц Confluence по ссылкам
- **ИИ анализ**: Использование GPT для поиска артефактов в документах
- **PDF отчеты**: Автоматическая генерация структурированных отчетов с русскими символами
- **Цветовая индикация**: Зеленый (найдено), желтый (частично), красный (не найдено)

## Архитектура артефактов

Система ищет следующие типы артефактов:

### Общие артефакты
- Паспорт проекта
- Техническое задание
- Архитектурная схема решения
- Матрица ответственности (RACI)
- Календарный план проекта

### Технические артефакты
- Параметры подключения к источникам данных
- Схема безопасности и управления доступом
- Описание процедур резервного копирования
- План восстановления после сбоев

### BI-специфичные артефакты
- Модель данных витрины
- Список KPI и метрик
- Макеты дашбордов и отчетов

### RPA-специфичные артефакты
- Карта автоматизируемого процесса
- Описание исключительных ситуаций
- Расписание выполнения роботов

### DWH-специфичные артефакты
- Концептуальная модель данных
- Описание процессов ETL/ELT
- SLA для загрузки данных

## Установка и настройка

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd python
```

### 2. Создание виртуального окружения
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate     # Windows
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` на основе `env.example`:
```bash
cp env.example .env
```

Заполните следующие переменные в файле `.env`:

#### **Обязательные настройки Mattermost:**
```env
MATTERMOST_URL=https://your-mattermost-server.com
MATTERMOST_TOKEN=your_bot_access_token
MATTERMOST_USERNAME=document-analyzer-bot
MATTERMOST_PASSWORD=your_bot_password
MATTERMOST_TEAM=your_team_name
```

#### **Обязательные настройки OpenAI:**
```env
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4-turbo
```

#### **Настройки Confluence (если используется):**
```env
CONFLUENCE_USERNAME=your-confluence-username
CONFLUENCE_PASSWORD=your-confluence-app-password
```

### 5. Создание бота в Mattermost

1. **Создайте бота в Mattermost:**
   - Перейдите в **System Console** > **Integrations** > **Bot Accounts**
   - Нажмите **Add Bot Account**
   - Заполните данные бота:
     - **Username**: `document-analyzer-bot`
     - **Display Name**: `Анализатор документов`
     - **Description**: `Бот для анализа документации ИТ проектов`
   - Сохраните **Access Token**

2. **Настройте права бота:**
   - Добавьте бота в нужную команду
   - Предоставьте права на чтение/запись сообщений
   - Разрешите загрузку файлов

### 6. Проверка настроек

Запустите тест компонентов:
```bash
python3 test_components.py
```

## Запуск бота

### Производственный запуск
```bash
python3 main.py
```

### Запуск с логированием
```bash
./start_bot.sh
```

### Фоновый запуск (Linux/Mac)
```bash
nohup python3 main.py > bot.log 2>&1 &
```

## Использование

1. **Начало анализа**: Напишите боту в личных сообщениях или упомяните в канале
2. **Выбор типов проектов**: Используйте кнопки для выбора (BI, DWH, RPA, MDM)
3. **Загрузка документов**: 
   - Прикрепите файлы (PDF, DOCX, XLSX, RTF, TXT)
   - Или отправьте ссылки на Confluence страницы
4. **Получение отчета**: Бот автоматически создаст и отправит PDF отчет

## Структура проекта

```
python/
├── main.py                 # Точка входа
├── config.py              # Управление конфигурацией
├── mattermost_bot.py      # Основной класс бота
├── document_processor.py  # Обработка документов
├── gpt_analyzer.py        # Анализ с помощью GPT
├── pdf_generator.py       # Генерация PDF отчетов
├── requirements.txt       # Python зависимости
├── env.example           # Пример настроек
├── start_bot.sh          # Скрипт запуска
└── test_components.py    # Тесты компонентов
```

## Устранение неполадок

### Проблемы с подключением к Mattermost
```bash
# Проверьте доступность сервера
curl -I https://your-mattermost-server.com

# Проверьте токен бота
curl -H "Authorization: Bearer your_token" \
     https://your-mattermost-server.com/api/v4/users/me
```

### Проблемы с OpenAI API
```bash
# Проверьте API ключ
curl -H "Authorization: Bearer sk-your-key" \
     https://api.openai.com/v1/models
```

### Проблемы с русскими символами в PDF
Система автоматически использует шрифты DejaVu Sans для корректного отображения кириллицы. Если возникают проблемы:

```bash
# Ubuntu/Debian
sudo apt-get install fonts-dejavu

# CentOS/RHEL
sudo yum install dejavu-sans-fonts
```

## Логирование

Логи сохраняются в:
- `bot.log` - основные события
- `error.log` - ошибки и исключения

Уровень логирования настраивается через переменную `LOG_LEVEL` в `.env`.

## Требования к системе

- **Python**: 3.8+
- **RAM**: минимум 512MB
- **Диск**: 100MB для кода + место для временных файлов
- **Сеть**: доступ к Mattermost, OpenAI API, Confluence

## Безопасность

- Все API ключи храните в переменных окружения
- Используйте HTTPS для всех подключений
- Регулярно обновляйте токены доступа
- Ограничьте права бота только необходимыми каналами

## Поддержка

Для получения помощи:
1. Проверьте логи бота
2. Запустите `test_components.py` для диагностики
3. Убедитесь в корректности всех настроек в `.env`

## Лицензия

Этот проект лицензирован под MIT License. 